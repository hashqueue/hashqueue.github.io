(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{356:function(s,a,n){"use strict";n.r(a);var t=n(7),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("本文转载自"),a("a",{attrs:{href:"https://www.cnblogs.com/peng104/p/10296717.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.cnblogs.com/peng104/p/10296717.html"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"引言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引言"}},[s._v("#")]),s._v(" 引言")]),s._v(" "),a("h2",{attrs:{id:"docker是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker是什么"}},[s._v("#")]),s._v(" docker是什么")]),s._v(" "),a("p",[s._v("Docker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，于 2013 年 3 月以 Apache 2.0 授权协议开源，主要项目代码在 GitHub 上进行维护。")]),s._v(" "),a("p",[s._v("Docker 使用 Google 公司推出的 Go 语言 进行开发实现。")]),s._v(" "),a("p",[s._v("docker是linux容器的一种封装，提供简单易用的容器使用接口。它是最流行的Linux容器解决方案。")]),s._v(" "),a("p",[s._v("docker的接口相当简单，用户可以方便的创建、销毁容器。")]),s._v(" "),a("p",[s._v("docker将应用程序与程序的依赖，打包在一个文件里面。运行这个文件就会生成一个虚拟容器。")]),s._v(" "),a("p",[s._v("程序运行在虚拟容器里，如同在真实物理机上运行一样，有了docker，就不用担心环境问题了。")]),s._v(" "),a("h2",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("p",[s._v("web应用的自动化打包和发布")]),s._v(" "),a("p",[s._v("自动化测试和持续集成、发布")]),s._v(" "),a("p",[s._v("在服务型环境中部署和调整数据库或其他应用")]),s._v(" "),a("h2",{attrs:{id:"区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#区别"}},[s._v("#")]),s._v(" 区别")]),s._v(" "),a("p",[s._v("物理机")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/hashqueue/blog-image-hosting@master/images/640-29556a5705f14b88a36ffd65a08dd641-e1f4c0edcc9a45b7a640d85ffe332e62.jpeg",alt:"640-29556a5705f14b88a36ffd65a08dd641"}})]),s._v(" "),a("p",[s._v("虚拟机")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/hashqueue/blog-image-hosting@master/images/642-1c5853b47f484f4c96fec05a7677e8dd-ba4c360469974c43a6fbb9af0753f297.png",alt:"642-1c5853b47f484f4c96fec05a7677e8dd"}})]),s._v(" "),a("p",[s._v("docker容器")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/hashqueue/blog-image-hosting@master/images/641-515e9b90642c43aaa255a8f04558ccc4-3789a1505b6d49f88ecb39df828712a0.jpeg",alt:"641-515e9b90642c43aaa255a8f04558ccc4"}})]),s._v(" "),a("h2",{attrs:{id:"docker的三大概念及优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker的三大概念及优势"}},[s._v("#")]),s._v(" Docker的三大概念及优势")]),s._v(" "),a("ul",[a("li",[s._v("镜像　image")]),s._v(" "),a("li",[s._v("容器　container")]),s._v(" "),a("li",[s._v("仓库　repository")])]),s._v(" "),a("h3",{attrs:{id:"docker容器的优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker容器的优势"}},[s._v("#")]),s._v(" docker容器的优势")]),s._v(" "),a("ul",[a("li",[s._v("更高效的利用系统资源\n"),a("ul",[a("li",[a("p",[s._v("由于容器不需要进行硬件虚拟以及运行完整操作系统等额外开销，Docker 对系统 资源的利用率更高。")])]),s._v(" "),a("li",[a("p",[s._v("无论是应用执行速度、内存损耗或者文件存储速度，都要比传 统虚拟机技术更高效。因此，相比虚拟机技术，一个相同配置的主机，往往可以运 行更多数量的应用。")])])])]),s._v(" "),a("li",[s._v("更快速的启动时间\n"),a("ul",[a("li",[s._v("传统的虚拟机技术启动应用服务往往需要数分钟，而 Docker 容器应用，由于直接 运行于宿主内核，无需启动完整的操作系统，因此可以做到秒级、甚至毫秒级的启 动时间。大大的节约了开发、测试、部署的时间。")])])]),s._v(" "),a("li",[s._v("一致的运行环境\n"),a("ul",[a("li",[s._v("开发过程中一个常见的问题是环境一致性问题。由于开发环境、测试环境、生产环 境不一致，导致有些 bug 并未在开发过程中被发现。")]),s._v(" "),a("li",[s._v("而 Docker 的镜像提供了除内 核外完整的运行时环境，确保了应用运行环境一致性，从而不会再出现 “这段代码 在我机器上没问题啊” 这类问题。")])])]),s._v(" "),a("li",[s._v("持续交付和部署\n"),a("ul",[a("li",[s._v("对开发和运维(DevOps)人员来说，最希望的就是一次创建或配置，可以在任意 地方正常运行。")]),s._v(" "),a("li",[s._v("使用 Docker 可以通过定制应用镜像来实现持续集成、持续交付、部署。开发人员 可以通过 Dockerfile 来进行镜像构建，并结合持续集成(Continuous Integration) 系 统进行集成测试，而运维人员则可以直接在生产环境中快速部署该镜像，甚至结合 持续部署(Continuous Delivery/Deployment) 系统进行自动部署。")]),s._v(" "),a("li",[s._v("而且使用 Dockerfile 使镜像构建透明化，不仅仅开发团队可以理解应用运行环 境，也方便运维团队理解应用运行所需条件，帮助更好的生产环境中部署该镜像。")])])]),s._v(" "),a("li",[s._v("更轻松的迁移\n"),a("ul",[a("li",[s._v("由于 Docker 确保了执行环境的一致性，使得应用的迁移更加容易。Docker 可以在 很多平台上运行，无论是物理机、虚拟机、公有云、私有云，甚至是笔记本，其运 行结果是一致的。")]),s._v(" "),a("li",[s._v("因此用户可以很轻易的将在一个平台上运行的应用，迁移到另一 个平台上，而不用担心运行环境的变化导致应用无法正常运行的情况。")])])])]),s._v(" "),a("h1",{attrs:{id:"docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装"}},[s._v("#")]),s._v(" Docker安装")]),s._v(" "),a("p",[s._v("系统环境：docker最低支持centos7且在64位平台上，内核版本在3.10以上")]),s._v(" "),a("p",[s._v("版本：社区版，企业版（包含了一些收费服务）")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/centos/#upgrade-docker-after-using-the-convenience-script",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方版安装教程(英文)"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("centos安装教程")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装docker")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker ")]),s._v("\nsystemctl start/status "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker启动状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("配置加速器")]),s._v(" "),a("p",[s._v("简介：DaoCloud 加速器 是广受欢迎的 Docker 工具，解决了国内用户访问 Docker Hub 缓慢的问题。DaoCloud 加速器结合国内的 CDN 服务与协议层优化，成倍的提升了下载速度。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.daocloud.io/mirror#accelerator-doc",target:"_blank",rel:"noopener noreferrer"}},[s._v("DaoCloud官网"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一条命令加速（记得重启docker）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sSL")]),s._v(" https://get.daocloud.io/daotools/set_mirror.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" http://95822026.m.daocloud.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h1",{attrs:{id:"docker基础命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker基础命令"}},[s._v("#")]),s._v(" Docker基础命令")]),s._v(" "),a("p",[s._v("docker --help（中文注解）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Usage:\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COMMAND "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" daemon "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nA\nself-sufficient runtime "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" containers.\n\nOptions:\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/.docker              Location of client config files  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户端配置文件的位置")]),s._v("\n  -D, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--debug")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false               Enable debug mode  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用Debug调试模式")]),s._v("\n  -H, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                   Daemon socket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to connect to  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#守护进程的套接字（Socket）连接")]),s._v("\n  -h, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                Print usage  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打印使用")]),s._v("\n  -l, --log-level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info            Set the logging level  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置日志级别")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tls")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                     Use TLS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" implied by--tlsverify  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tlscacert")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/.docker/ca.pem    Trust certs signed only by this CA  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#信任证书签名CA")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tlscert")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/.docker/cert.pem    Path to TLS certificate "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TLS证书文件路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tlskey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/.docker/key.pem      Path to TLS key "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TLS密钥文件路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tlsverify")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false               Use TLS and verify the remote  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用TLS验证远程")]),s._v("\n  -v, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false             Print version information and quit  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打印版本信息并退出")]),s._v("\n\nCommands:\n    attach    Attach to a running container  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前shell下attach连接指定运行镜像")]),s._v("\n    build     Build an image from a Dockerfile  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过Dockerfile定制镜像")]),s._v("\n    commit    Create a new image from a container"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s changes  #提交当前容器为新的镜像\n    cp    Copy files/folders from a container to a HOSTDIR or to STDOUT  #从容器中拷贝指定文件或者目录到宿主机中\n    create    Create a new container  #创建一个新的容器，同run 但不启动容器\n    diff    Inspect changes on a container'")]),s._v("s filesystem  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker容器变化")]),s._v("\n    events    Get real "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" events from the server"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从docker服务获取容器实时事件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("    Run a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a running container"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在已存在的容器上运行命令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v("    Export a container"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s filesystem as a tar archive  #导出容器的内容流作为一个tar归档文件(对应import)\n    history    Show the history of an image  #展示一个镜像形成历史\n    images    List images  #列出系统当前镜像\n    import    Import the contents from a tarball to create a filesystem image  #从tar包中的内容创建一个新的文件系统映像(对应export)\n    info    Display system-wide information  #显示系统相关信息\n    inspect    Return low-level information on a container or image  #查看容器详细信息\n    kill    Kill a running container  #kill指定docker容器\n    load    Load an image from a tar archive or STDIN  #从一个tar包中加载一个镜像(对应save)\n    login    Register or log in to a Docker registry#注册或者登陆一个docker源服务器\n    logout    Log out from a Docker registry  #从当前Docker registry退出\n    logs    Fetch the logs of a container  #输出当前容器日志信息\n    pause    Pause all processes within a container#暂停容器\n    port    List port mappings or a specific mapping for the CONTAINER  #查看映射端口对应的容器内部源端口\n    ps    List containers  #列出容器列表\n    pull    Pull an image or a repository from a registry  #从docker镜像源服务器拉取指定镜像或者库镜像\n    push    Push an image or a repository to a registry  #推送指定镜像或者库镜像至docker源服务器\n    rename    Rename a container  #重命名容器\n    restart    Restart a running container  #重启运行的容器\n    rm    Remove one or more containers  #移除一个或者多个容器\n    rmi    Remove one or more images  #移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)\n    run    Run a command in a new container  #创建一个新的容器并运行一个命令\n    save    Save an image(s) to a tar archive#保存一个镜像为一个tar包(对应load)\n    search    Search the Docker Hub for images  #在docker\nhub中搜索镜像\n    start    Start one or more stopped containers#启动容器\n    stats    Display a live stream of container(s) resource usage statistics  #统计容器使用资源\n    stop    Stop a running container  #停止容器\n    tag         Tag an image into a repository  #给源中镜像打标签\n    top       Display the running processes of a container #查看容器中运行的进程信息\n    unpause    Unpause all processes within a container  #取消暂停容器\n    version    Show the Docker version information#查看容器版本号\n    wait         Block until a container stops, then print its exit code  #截取容器停止时的退出状态值\n\nRun '")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" COMMAND --help' "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information on a command.  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行docker命令在帮助可以获取更多信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search  hello-docker  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索hello-docker的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search centos "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索centos镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull hello-docker "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取centos镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run  hello-world   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行一个docker镜像，产生一个容器实例（也可以通过镜像id前三位运行）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看本地所有镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image rmi hello-docker "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除centos镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出正在运行的容器（如果创建容器中没有进程正在运行，容器就会立即停止）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有运行过的容器记录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save centos "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/centos.tar.gz  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出docker镜像至本地")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /opt/centos.tar.gz   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导入本地镜像到docker镜像库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop  "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aq")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止所有正在运行的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aq")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一次性删除所有容器记录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi  "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aq")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一次性删除所有本地的镜像记录")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br")])]),a("h2",{attrs:{id:"启动容器的两种方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器的两种方式"}},[s._v("#")]),s._v(" 启动容器的两种方式")]),s._v(" "),a("p",[s._v("容器是运行应用程序的，所以必须得先有一个操作系统为基础")]),s._v(" "),a("p",[s._v("1、 基于镜像新建一个容器并启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 后台运行一个docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" centos /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true;do echo 正在运行; sleep 1;done"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d  后台运行容器")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /bin/sh  指定使用centos的bash解释器")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c 运行一段shell命令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "while true;do echo 正在运行; sleep 1;done"  在linux后台，每秒中打印一次正在运行')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查容器进程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("  logs  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("  容器id/名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不间断打印容器的日志信息 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop centos  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止容器")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 启动一个bash终端,允许用户进行交互")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mydocker "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" centos /bin/bash  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --name  给容器定义一个名称")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i  让容器的标准输入保持打开")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t 让Docker分配一个伪终端,并绑定到容器的标准输入上")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /bin/bash 指定docker容器，用shell解释器交互")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("当利用docker run来创建容器时，Docker在后台运行的步骤如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("检查本地是否存在指定的镜像，不存在就从公有仓库下载\n利用镜像创建并启动一个容器\n分配一个文件系统，并在只读的镜像层外面挂在一层可读写层\n从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去\n从地址池配置一个ip地址给容器\n执行用户指定的应用程序\n执行完毕后容器被终止\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("2、将一个终止状态(stopped)的容器重新启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps -a  # 先查询记录")]),s._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS                    NAMES\nee92fcf6f32d        centos              "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago          Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" days ago                                kickass_raman\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker start ee9  # 再启动这个容器")]),s._v("\nee9\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it  ee9 /bin/bash  # 进入容器交互式界面")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ee92fcf6f32d /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   # 注意看用户名，已经变成容器用户名")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"提交创建自定义镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提交创建自定义镜像"}},[s._v("#")]),s._v(" 提交创建自定义镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.我们进入交互式的centos容器中，发现没有vim命令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" centos\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.在当前容器中，安装一个vim")]),s._v("\n    yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.安装好vim之后，exit退出容器")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.查看刚才安装好vim的容器记录")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.提交这个容器，创建新的image")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit 059fdea031ba chaoyu/centos-vim\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6.查看镜像文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nchaoyu/centos-vim   latest              fd2685ae25fe        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" minutes ago   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"外部访问容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#外部访问容器"}},[s._v("#")]),s._v(" 外部访问容器")]),s._v(" "),a("p",[s._v("容器中可以运行网络应用，但是要让外部也可以访问这些应用，可以通过-p或-P参数指定端口映射。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" training/webapp python app.py\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -P 参数会随机映射端口到容器开放的网络端口")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查映射的端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\nCONTAINER ID        IMAGE               COMMAND             CREATED            STATUS              PORTS                     NAMES\ncfd632821d7a        training/webapp     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:32768-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   brave_fermi\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#宿主机ip:32768 映射容器的5000端口")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器日志信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" cfd  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# #不间断显示log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以通过-p参数指定映射端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v(":5000 training/webapp python app.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("打开浏览器访问服务器的9000端口， 内容显示 Hello world！表示正常启动")]),s._v(" "),a("p",[s._v("(如果访问失败的话，检查自己的防火墙，以及云服务器的安全组)")]),s._v(" "),a("h1",{attrs:{id:"利用dockerfile定制镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用dockerfile定制镜像"}},[s._v("#")]),s._v(" 利用dockerfile定制镜像")]),s._v(" "),a("p",[s._v("镜像是容器的基础，每次执行docker run的时候都会指定哪个镜像作为容器运行的基础。我们之前的例子都是使用来自docker hub的镜像，直接使用这些镜像只能满足一定的需求，当镜像无法满足我们的需求时，就得自定制这些镜像。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("镜像的定制就是定制每一层所添加的配置、文件。如果可以吧每一层修改、安装、构建、操作的命令都写入到一个脚本，用脚本来构建、定制镜像，这个脚本就是dockerfile。\n\nDockerfile 是一个文本文件，其内包含了一条条的指令"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Instruction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，每一条指令 构建一层，因此每一条指令的内容，就是描述该层应当如何构建。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("参数详解")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("FROM scratch "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#制作base image 基础镜像，尽量使用官方的image作为base image")]),s._v("\nFROM centos "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用base image")]),s._v("\nFROM ubuntu:14.04 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#带有tag的base image")]),s._v("\n\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“1.0” "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器元信息，帮助信息，Metadata，类似于代码注释")]),s._v("\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“yc_uuu@163.com"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n\n#对于复杂的RUN命令，避免无用的分层，多条命令用反斜线换行，合成一条命令！\nRUN yum update && yum install -y vim \n    Python-dev #反斜线换行\nRUN /bin/bash -c "')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.bashrc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("”\n\nWORKDIR /root "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#相当于linux的cd命令，改变目录，尽量使用绝对路径！！！不要用RUN cd")]),s._v("\nWORKDIR /test "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有就自动创建")]),s._v("\nWORKDIR demo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再进入demo文件夹")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印结果应该是/test/demo")]),s._v("\n\nADD and COPY \nADD hello /  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把本地文件添加到镜像中，吧本地的hello可执行文件拷贝到镜像的/目录")]),s._v("\nADD test.tar.gz /  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加到根目录并解压")]),s._v("\n\nWORKDIR /root\nADD hello test/  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/root/ 添加hello可执行命令到test目录下，也就是/root/test/hello 一个绝对路径")]),s._v("\nCOPY hello test/  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等同于上述ADD效果")]),s._v("\n\nADD与COPY\n   - 优先使用COPY命令\n    -ADD除了COPY功能还有解压功能\n添加远程文件/目录使用curl或wget\n\nENV "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 环境变量，尽可能使用ENV增加可维护性")]),s._v("\nENV MYSQL_VERSION "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置一个mysql常量")]),s._v("\nRUN yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" mysql-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYSQL_VERSION}")]),s._v("” \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("进阶知识(了解)")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("VOLUME and EXPOSE \n存储和网络\n\nRUN and CMD and ENTRYPOINT\nRUN：执行命令并创建新的Image Layer\nCMD：设置容器启动后默认执行的命令和参数\nENTRYPOINT：设置容器启动时运行的命令\n\nShell格式和Exec格式\nRUN yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" ”hello docker”\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" “hello docker”\n\nExec格式\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“apt-get”,”install”,”-y”,”vim”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“/bin/echo”,”hello docker”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“/bin/echo”,”hello docker”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n通过shell格式去运行命令，会读取"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v("指令，而exec格式是仅仅的执行一个命令，而不是shell指令\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" Dockerfile\n    FROM centos\n    ENV name Docker\n    ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“/bin/echo”,”hello "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v("”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个仅仅是执行echo命令，读取不了shell变量")]),s._v("\n    ENTRYPOINT  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“/bin/bash”,”-c”,”echo hello "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"]\n\nCMD\n容器启动时默认执行的命令\n如果docker run指定了其他命令(docker run -it [image] /bin/bash )，CMD命令被忽略\n如果定义多个CMD，只有最后一个执行\n\nENTRYPOINT\n让容器以应用程序或服务形式运行\n不会被忽略，一定会执行\n最佳实践：写一个shell脚本作为entrypoint\nCOPY docker-entrypoint.sh /usr/local/bin\nENTRYPOINT [“docker-entrypoint.sh]\nEXPOSE 27017\nCMD [“mongod”]\n\n[root@master home]# more Dockerfile\nFROm centos\nENV name Docker\n#CMD ["')]),s._v("/bin/bash"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v("-c"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"]\nENTRYPOINT ["')]),s._v("/bin/bash"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v("-c"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v("”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("h1",{attrs:{id:"发布到仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布到仓库"}},[s._v("#")]),s._v(" 发布到仓库")]),s._v(" "),a("h2",{attrs:{id:"docker-hub公有镜像发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub公有镜像发布"}},[s._v("#")]),s._v(" docker hub公有镜像发布")]),s._v(" "),a("p",[s._v("docker提供了一个类似于github的仓库docker hub。"),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方网站(需注册使用)"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注册docker id后，在linux中登录dockerhub")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意要保证image的tag是账户名，如果镜像名字不对，需要改一下tag")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag chaoyu/centos-vim peng104/centos-vim\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法是：docker tag   仓库名   peng104/仓库名")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送docker image到dockerhub")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push peng104/centps-cmd-exec:latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 去dockerhub中检查镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先删除本地镜像，然后再测试下载pull 镜像文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull peng104/centos-entrypoint-exec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#私有仓库"}},[s._v("#")]),s._v(" 私有仓库")]),s._v(" "),a("p",[s._v("docker hub 是公开的，其他人也是可以下载，并不安全，因此还可以使用docker registry官方提供的私有仓库")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://yeasy.gitbooks.io/docker_practice/repository/registry.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("用法详解"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.下载一个docker官方私有仓库镜像")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.运行一个docker私有容器仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /opt/data/registry:/var/lib/registry  registry\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" 后台运行 \n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("  端口映射 宿主机的5000:容器内的5000\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("  数据卷挂载  宿主机的 /opt/data/registry :/var/lib/registry \n    registry  镜像名\n    /var/lib/registry  存放私有仓库位置\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker 默认不允许非 HTTPS 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.修改docker的配置文件，让他支持http方式，上传私有镜像")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入如下内容")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://f1361db2.m.daocloud.io"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.11.37:5000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.修改docker的服务配置文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /lib/systemd/system/docker.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到[service]这一代码区域块，写入如下参数")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/etc/docker/daemon.json\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.重新加载docker服务")]),s._v("\n    systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6.重启docker服务")]),s._v("\n    systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意:重启docker服务，所有的容器都会挂掉")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7.修改本地镜像的tag标记，往自己的私有仓库推送")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag docker.io/peng104/hello-world-docker "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.37:5000/peng-hello\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 浏览器访问http://192.168.119.10:5000/v2/_catalog查看仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8.下载私有仓库的镜像")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.37:5000/peng-hello\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h2",{attrs:{id:"实例演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例演示"}},[s._v("#")]),s._v(" 实例演示")]),s._v(" "),a("p",[s._v("编写dockerfile，构建自己的镜像，运行flask程序。")]),s._v(" "),a("p",[s._v("确保app.py和dockerfile在同一个目录！")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.准备好app.py的flask程序")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat app.py")]),s._v("\n    from flask "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" Flask\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    @app.route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    def hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("__name__")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        app.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(",port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n    app.py  Dockerfile\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.编写dockerfile")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat Dockerfile")]),s._v("\n    FROM python:2.7\n    LABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"温而新"')]),s._v("\n    RUN pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" flask\n    COPY app.py /app/\n    WORKDIR /app\n    EXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n    CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.构建镜像image,找到当前目录的Dockerfile，开始构建")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" peng104/flask-hello-docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.查看创建好的images")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.启动此flask-hello-docker容器，映射一个端口供外部访问")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 peng104/flask-hello-docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6.检查运行的容器")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7.推送这个镜像到私有仓库")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag  peng104/flask-hello-docker   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.37:5000/peng-flaskweb\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.37:5000/peng-flaskweb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("h2",{attrs:{id:"更多的docker内容可以参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多的docker内容可以参考"}},[s._v("#")]),s._v(" 更多的Docker内容可以参考")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/71_nGe6zUdRxCRQFckhITQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 从入门到掉坑"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/akGgmn1Fc8abMA62i8diwg",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker从入门到掉坑(二)：基于Docker构建SpringBoot微服务"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/5cRXEwFkPDJrgYuI1jCwNw",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker从入门到掉坑(三)：容器太多，操作好麻烦"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/QIsQoWmuZbmhXViLXxBN9A",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker从入门到掉坑(四)：上手k8s避坑指南"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/O-sSPnBBFS8l3yz6wT0i9g",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker从入门到掉坑(五)：继续挖一挖 k8s"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/-bgoBEE7dsALgNNttJYhvQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("面试官：你简历中写用过docker，能说说容器和镜像的区别吗？"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/nKyjNapebQLxM0m2PF5rIQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("手把手教你实现 Docker 部署 Redis 集群"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);